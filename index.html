<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.9.1"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Hoel: Hoel</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">Hoel
   </div>
   <div id="projectbrief">C Database abstraction library with json based language</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.1 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search','.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
</div><!-- top -->
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="PageDoc"><div class="header">
  <div class="headertitle">
<div class="title">Hoel </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p><a class="anchor" id="md_README"></a> <img src="https://github.com/babelouest/hoel/workflows/.github/workflows/ccpp.yml/badge.svg" alt=".github/workflows/ccpp.yml" style="pointer-events: none;" class="inline"/></p>
<p>Database abstraction library written in C.</p>
<p>Simple and easy to use database access library. Works with SQLite 3, MariaDB and PostgreSQL databases. Uses a JSON-based language with <code>jansson</code> to execute simple queries based on one table.</p>
<h1><a class="anchor" id="autotoc_md1"></a>
Online documentation</h1>
<p>See the <a href="https://babelouest.github.io/hoel/">online documentation</a> for a doxygen format of the API documentation.</p>
<h1><a class="anchor" id="autotoc_md2"></a>
Installation</h1>
<h2><a class="anchor" id="autotoc_md3"></a>
Prerequisites</h2>
<h3><a class="anchor" id="autotoc_md4"></a>
Jansson</h3>
<p>Install <a href="http://www.digip.org/jansson/">Jansson</a> library for JSON manipulation, minimum version 2.4. On a Debian-based platform, run the following command:</p>
<div class="fragment"><div class="line">$ sudo apt-get install libjansson-dev</div>
</div><!-- fragment --><h3><a class="anchor" id="autotoc_md5"></a>
Database libraries</h3>
<p>Install Hoel database dependencies based on your requirements:</p><ul>
<li>SQLite3: Install the package <code>libsqlite3-dev</code></li>
<li>MariaDB: Install the package <code>libmariadb-dev</code></li>
<li>PostgreSQL: Install the package <code>libpq-dev</code></li>
</ul>
<h3><a class="anchor" id="autotoc_md6"></a>
Distribution packages</h3>
<p><a href="https://repology.org/metapackage/hoel"><img src="https://repology.org/badge/vertical-allrepos/hoel.svg" alt="Packaging status" style="pointer-events: none;" class="inline"/></a></p>
<p>Hoel is available in multiple distributions as official package. Check out your distribution documentation to install the package automatically.</p>
<div class="fragment"><div class="line">$ # Example for Debian testing</div>
<div class="line">$ sudo apt install libhoel-dev</div>
</div><!-- fragment --><h3><a class="anchor" id="autotoc_md7"></a>
Pre-compiled packages</h3>
<p>You can install Hoel with a pre-compiled package available in the <a href="https://github.com/babelouest/hoel/releases/latest/">release pages</a>. <code>jansson</code>, <code>sqlite3</code>, <code>libmariadb-client</code> and <code>libpq</code> development files packages are required to install Hoel. The packages files <code>hoel-dev-full_*</code> contain the libraries <code>orcania</code>, <code>yder</code> and <code>hoel</code>. It's also compiled with all the database backends.</p>
<p>For example, to install Hoel with the <code>hoel-dev-full_2.3.0_Debian_stretch_x86_64.tar.gz</code> package downloaded on the <code>releases</code> page, you must execute the following commands:</p>
<div class="fragment"><div class="line">$ sudo apt install -y libjansson-dev libmariadb-dev libsqlite3-dev libpq-dev libsystemd-dev</div>
<div class="line">$ wget https://github.com/babelouest/hoel/releases/download/v1.4.0/hoel-dev-full_1.4.0_Debian_stretch_x86_64.tar.gz</div>
<div class="line">$ tar xf hoel-dev-full_1.4.0_Debian_stretch_x86_64.tar.gz</div>
<div class="line">$ sudo dpkg -i liborcania-dev_1.2.0_Debian_stretch_x86_64.deb</div>
<div class="line">$ sudo dpkg -i libyder-dev_1.2.0_Debian_stretch_x86_64.deb</div>
<div class="line">$ sudo dpkg -i libhoel-dev_1.4.0_Debian_stretch_x86_64.deb</div>
</div><!-- fragment --><p>If there's no package available for your distribution, you can recompile it manually using <code>CMake</code> or <code>Makefile</code>.</p>
<h2><a class="anchor" id="autotoc_md8"></a>
Install from the source</h2>
<h3><a class="anchor" id="autotoc_md9"></a>
CMake - Multi architecture</h3>
<p><a href="https://cmake.org/download/">CMake</a> minimum 3.5 is required.</p>
<p>Last Hoel release: <a href="https://github.com/babelouest/hoel/releases/latest/">https://github.com/babelouest/hoel/releases/latest/</a></p>
<p>Run the CMake script in a sub-directory, example:</p>
<div class="fragment"><div class="line">$ cd &lt;hoel_source&gt;</div>
<div class="line">$ mkdir build</div>
<div class="line">$ cd build</div>
<div class="line">$ cmake ..</div>
<div class="line">$ make &amp;&amp; sudo make install</div>
</div><!-- fragment --><p>The available options for CMake are:</p><ul>
<li><code>-DWITH_SQLITE3=[on|off]</code> (default <code>on</code>): Enable/disable SQLite3 database backend</li>
<li><code>-DWITH_MARIADB=[on|off]</code> (default <code>on</code>): Enable/disable MariaDB database backend</li>
<li><code>-DWITH_PGSQL=[on|off]</code> (default <code>on</code>): Enable/disable PostgreSQL database backend</li>
<li><code>-DWITH_JOURNALD=[on|off]</code> (default <code>on</code>): Build with journald (SystemD) support for logging</li>
<li><code>-DBUILD_STATIC=[on|off]</code> (default <code>off</code>): Build the static archive in addition to the shared library</li>
<li><code>-DBUILD_HOEL_TESTING=[on|off]</code> (default <code>off</code>): Build unit tests</li>
<li><code>-DBUILD_HOEL_DOCUMENTATION=[on|off]</code> (default <code>off</code>): Build the documentation, doxygen is required</li>
<li><code>-DINSTALL_HEADER=[on|off]</code> (default <code>on</code>): Install header file <code><a class="el" href="hoel_8h.html" title="Hoel database abstraction library.">hoel.h</a></code></li>
<li><code>-DBUILD_RPM=[on|off]</code> (default <code>off</code>): Build RPM package when running <code>make package</code></li>
<li><code>-DCMAKE_BUILD_TYPE=[Debug|Release]</code> (default <code>Release</code>): Compile with debugging symbols or not</li>
</ul>
<h3><a class="anchor" id="autotoc_md10"></a>
Good ol' Makefile</h3>
<p>Clone, compile and install <a href="https://github.com/babelouest/orcania">Orcania</a> and <a href="https://github.com/babelouest/yder">Yder</a> libraries.</p>
<h3><a class="anchor" id="autotoc_md11"></a>
Orcania (Miscellaneous functions)</h3>
<p>Last Orcania release: <a href="https://github.com/babelouest/orcania/releases/latest/">https://github.com/babelouest/orcania/releases/latest/</a></p>
<div class="fragment"><div class="line">$ cd orcania/src</div>
<div class="line">$ make &amp;&amp; sudo make install</div>
</div><!-- fragment --><h3><a class="anchor" id="autotoc_md12"></a>
Yder (simple logs library)</h3>
<p>Last Yder release: <a href="https://github.com/babelouest/yder/releases/latest/">https://github.com/babelouest/yder/releases/latest/</a></p>
<div class="fragment"><div class="line">$ cd yder/src</div>
<div class="line">$ make</div>
<div class="line">$ sudo make install</div>
</div><!-- fragment --><h3><a class="anchor" id="autotoc_md13"></a>
Hoel</h3>
<p>Last Hoel release: <a href="https://github.com/babelouest/hoel/releases/latest/">https://github.com/babelouest/hoel/releases/latest/</a></p>
<div class="fragment"><div class="line">$ cd hoel/src</div>
<div class="line">$ make</div>
<div class="line">$ sudo make install</div>
</div><!-- fragment --><p>By default, Hoel is compiled with the 3 databases support. If you don't need one or more database, follow these instructions</p>
<h4><a class="anchor" id="autotoc_md14"></a>
SQLite 3</h4>
<p>Add DISABLE_SQLITE=1 to the <code>make</code> command:</p>
<div class="fragment"><div class="line">$ cd hoel/src</div>
<div class="line">$ make DISABLE_SQLITE=1</div>
<div class="line">$ sudo make install</div>
</div><!-- fragment --><h4><a class="anchor" id="autotoc_md15"></a>
MariaDB</h4>
<p>Add DISABLE_MARIADB=1 to the <code>make</code> command:</p>
<div class="fragment"><div class="line">$ cd hoel/src</div>
<div class="line">$ make DISABLE_MARIADB=1</div>
<div class="line">$ sudo make install</div>
</div><!-- fragment --><h4><a class="anchor" id="autotoc_md16"></a>
Postgre SQL</h4>
<p>Add DISABLE_POSTGRESQL=1 to the <code>make</code> command:</p>
<div class="fragment"><div class="line">$ cd hoel/src</div>
<div class="line">$ make DISABLE_POSTGRESQL=1</div>
<div class="line">$ sudo make install</div>
</div><!-- fragment --><h3><a class="anchor" id="autotoc_md17"></a>
Disable 2 backends</h3>
<p>You can disable 2 databases backends to keep just one, simply add both parameters to the <code>make</code> command:</p>
<div class="fragment"><div class="line">$ cd hoel/src</div>
<div class="line">$ make DISABLE_MARIADB=1 DISABLE_POSTGRESQL=1</div>
<div class="line">$ sudo make install</div>
</div><!-- fragment --><h3><a class="anchor" id="autotoc_md18"></a>
Installation folder</h3>
<p>By default, the shared library and the header file will be installed in the <code>/usr/local</code> location. To change this setting, you can modify the <code>DESTDIR</code> value in the <code>src/Makefile</code>.</p>
<h1><a class="anchor" id="autotoc_md19"></a>
API Documentation</h1>
<h2><a class="anchor" id="autotoc_md20"></a>
Header files and compilation</h2>
<p>To use Hoel in your code, include the file <code><a class="el" href="hoel_8h.html" title="Hoel database abstraction library.">hoel.h</a></code>.</p>
<div class="fragment"><div class="line"><span class="preprocessor">#include &lt;<a class="code" href="hoel_8h.html">hoel.h</a>&gt;</span></div>
<div class="ttc" id="ahoel_8h_html"><div class="ttname"><a href="hoel_8h.html">hoel.h</a></div><div class="ttdoc">Hoel database abstraction library.</div></div>
</div><!-- fragment --><p>Use the flag <code>-lhoel</code> to include Hoel library in the linking process.</p>
<h3><a class="anchor" id="autotoc_md21"></a>
Return values</h3>
<p>When specified, some functions return <code>H_OK</code> on success, and other values otherwise. <code>H_OK</code> is 0, other values are non-0 values. The defined errors list is the following:</p>
<div class="fragment"><div class="line"><span class="preprocessor">#define H_OK                0  </span><span class="comment">// No error</span></div>
<div class="line"><span class="preprocessor">#define H_ERROR             1  </span><span class="comment">// Generic error</span></div>
<div class="line"><span class="preprocessor">#define H_ERROR_PARAMS      2  </span><span class="comment">// Error in input parameters</span></div>
<div class="line"><span class="preprocessor">#define H_ERROR_CONNECTION  3  </span><span class="comment">// Error in database connection</span></div>
<div class="line"><span class="preprocessor">#define H_ERROR_DISABLED    4  </span><span class="comment">// Database connection is disabled</span></div>
<div class="line"><span class="preprocessor">#define H_ERROR_QUERY       5  </span><span class="comment">// Error executing query</span></div>
<div class="line">#define H_ERROR_MEMORY      99 <span class="comment">// Error allocating memory</span></div>
</div><!-- fragment --><h3><a class="anchor" id="autotoc_md22"></a>
Memory allocation</h3>
<p>Some function return allocated values. When the value is not a structure, you must use the function <code>h_free</code> to clean it. Otherwise, use the dedicated functions.</p>
<div class="fragment"><div class="line"> </div>
<div class="line"><span class="keywordtype">void</span> <a class="code" href="group__memory.html#ga8e836d6e4152a26211a31f94b819ce56">h_free</a>(<span class="keywordtype">void</span> * data);</div>
<div class="ttc" id="agroup__memory_html_ga8e836d6e4152a26211a31f94b819ce56"><div class="ttname"><a href="group__memory.html#ga8e836d6e4152a26211a31f94b819ce56">h_free</a></div><div class="ttdeci">void h_free(void *data)</div><div class="ttdef"><b>Definition:</b> hoel.c:32</div></div>
</div><!-- fragment --><h3><a class="anchor" id="autotoc_md23"></a>
Initialization</h3>
<p>To create a connection to a database, use its dedicated function</p>
<div class="fragment"><div class="line"> </div>
<div class="line"><span class="keyword">struct </span><a class="code" href="struct__h__connection.html">_h_connection</a> * <a class="code" href="group__init.html#ga8d57dba0fe4db20b82f7e093bb15a33f">h_connect_sqlite</a>(<span class="keyword">const</span> <span class="keywordtype">char</span> * db_path);</div>
<div class="line"> </div>
<div class="line"><span class="keyword">struct </span><a class="code" href="struct__h__connection.html">_h_connection</a> * <a class="code" href="group__init.html#gac28e6b2231b51c221555dc2be9d0d4e1">h_connect_mariadb</a>(<span class="keyword">const</span> <span class="keywordtype">char</span> * host, <span class="keyword">const</span> <span class="keywordtype">char</span> * user, <span class="keyword">const</span> <span class="keywordtype">char</span> * passwd, <span class="keyword">const</span> <span class="keywordtype">char</span> * db, <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> port, <span class="keyword">const</span> <span class="keywordtype">char</span> * unix_socket);</div>
<div class="line"> </div>
<div class="line"><span class="keyword">struct </span><a class="code" href="struct__h__connection.html">_h_connection</a> * <a class="code" href="group__init.html#ga54db020c4dbb39e397510ae83b7a8c3c">h_connect_pgsql</a>(<span class="keywordtype">char</span> * conninfo);</div>
<div class="ttc" id="agroup__init_html_ga54db020c4dbb39e397510ae83b7a8c3c"><div class="ttname"><a href="group__init.html#ga54db020c4dbb39e397510ae83b7a8c3c">h_connect_pgsql</a></div><div class="ttdeci">struct _h_connection * h_connect_pgsql(const char *conninfo)</div><div class="ttdef"><b>Definition:</b> hoel-pgsql.c:410</div></div>
<div class="ttc" id="agroup__init_html_ga8d57dba0fe4db20b82f7e093bb15a33f"><div class="ttname"><a href="group__init.html#ga8d57dba0fe4db20b82f7e093bb15a33f">h_connect_sqlite</a></div><div class="ttdeci">struct _h_connection * h_connect_sqlite(const char *db_path)</div><div class="ttdef"><b>Definition:</b> hoel-sqlite.c:324</div></div>
<div class="ttc" id="agroup__init_html_gac28e6b2231b51c221555dc2be9d0d4e1"><div class="ttname"><a href="group__init.html#gac28e6b2231b51c221555dc2be9d0d4e1">h_connect_mariadb</a></div><div class="ttdeci">struct _h_connection * h_connect_mariadb(const char *host, const char *user, const char *passwd, const char *db, const unsigned int port, const char *unix_socket)</div><div class="ttdef"><b>Definition:</b> hoel-mariadb.c:437</div></div>
<div class="ttc" id="astruct__h__connection_html"><div class="ttname"><a href="struct__h__connection.html">_h_connection</a></div><div class="ttdef"><b>Definition:</b> hoel.h:87</div></div>
</div><!-- fragment --><p>All these functions return a struct <a class="el" href="struct__h__connection.html">_h_connection</a> * on success. This pointer will be needed on every call to Hoel functions.</p>
<p>When you no longer need your connection, close it using the function <code>h_close_db</code>. This will close the connection to the database and free the memory allocated by the connection.</p>
<div class="fragment"><div class="line"> </div>
<div class="line"><span class="keywordtype">int</span> <a class="code" href="group__init.html#gab40470ec35a8b69aab63d0938fd2c5d0">h_close_db</a>(<span class="keyword">struct</span> <a class="code" href="struct__h__connection.html">_h_connection</a> * conn);</div>
<div class="ttc" id="agroup__init_html_gab40470ec35a8b69aab63d0938fd2c5d0"><div class="ttname"><a href="group__init.html#gab40470ec35a8b69aab63d0938fd2c5d0">h_close_db</a></div><div class="ttdeci">int h_close_db(struct _h_connection *conn)</div><div class="ttdef"><b>Definition:</b> hoel.c:40</div></div>
</div><!-- fragment --><p>The connection must be cleaned when it's no longer needed.</p>
<div class="fragment"><div class="line"> </div>
<div class="line"><span class="keywordtype">int</span> <a class="code" href="group__init.html#ga2b25bbc6f6ad1b2cdc6fbfa699107f02">h_clean_connection</a>(<span class="keyword">struct</span> <a class="code" href="struct__h__connection.html">_h_connection</a> * conn);</div>
<div class="ttc" id="agroup__init_html_ga2b25bbc6f6ad1b2cdc6fbfa699107f02"><div class="ttname"><a href="group__init.html#ga2b25bbc6f6ad1b2cdc6fbfa699107f02">h_clean_connection</a></div><div class="ttdeci">int h_clean_connection(struct _h_connection *conn)</div><div class="ttdef"><b>Definition:</b> hoel.c:633</div></div>
</div><!-- fragment --><h3><a class="anchor" id="autotoc_md24"></a>
Escape string</h3>
<p>If you need to escape parameters, you can use the functions <code>h_escape_string</code>, the returned value must be h_free'd after use.</p>
<p>The meaning of existence of the function <code>h_escape_string_with_quotes</code> is because of PostgreSQL ways to escape an unsafe string.</p>
<p>TL;DR:</p><ul>
<li>Use <code>h_escape_string_with_quotes</code> only if you use a PostgreSQL database.</li>
<li>You can use both <code>h_escape_string_with_quotes</code> and <code>h_escape_string</code> if you use only SQLite3 and/or MariaDB databases.</li>
</ul>
<p>If the unsafe string contains backslashes <code>"\"</code>, the escaped string will have the pattern &lsquo;E&rsquo;&lt;safe&gt;'<code>, otherwise it will have the pattern</code>'&lt;safe&gt;'<code>. Since the function</code>h_escape_string<code>must return the safe string only, without surroundings quotes</code>'<code>, the format</code>E'&lt;safe&gt;'` is incompatible with Hoel API.</p>
<p>Therefore, using <code>h_escape_string</code> with PostgreSQL could lead to undefined behaviour and more importantly exploitable bugs.</p>
<p>To avoid this, on a PostgreSQL database, an escaped string using <code>h_escape_string</code> that should return the format &lsquo;E&rsquo;&lt;safe&gt;'<code>will return</code>NULL<code>, and an escaped string using</code>h_escape_string_with_quotes<code>will return the format</code>E'&lt;safe&gt;'`.</p>
<div class="fragment"><div class="line"> </div>
<div class="line"><span class="keywordtype">char</span> * <a class="code" href="group__escape.html#ga4146123cb657f469b6679ab0978b90b4">h_escape_string</a>(<span class="keyword">const</span> <span class="keyword">struct</span> <a class="code" href="struct__h__connection.html">_h_connection</a> * conn, <span class="keyword">const</span> <span class="keywordtype">char</span> * unsafe);</div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">char</span> * <a class="code" href="group__escape.html#gaa2be296b0ea863bc93b06e2ff8a5666c">h_escape_string_with_quotes</a>(<span class="keyword">const</span> <span class="keyword">struct</span> <a class="code" href="struct__h__connection.html">_h_connection</a> * conn, <span class="keyword">const</span> <span class="keywordtype">char</span> * unsafe);</div>
<div class="ttc" id="agroup__escape_html_ga4146123cb657f469b6679ab0978b90b4"><div class="ttname"><a href="group__escape.html#ga4146123cb657f469b6679ab0978b90b4">h_escape_string</a></div><div class="ttdeci">char * h_escape_string(const struct _h_connection *conn, const char *unsafe)</div><div class="ttdef"><b>Definition:</b> hoel.c:73</div></div>
<div class="ttc" id="agroup__escape_html_gaa2be296b0ea863bc93b06e2ff8a5666c"><div class="ttname"><a href="group__escape.html#gaa2be296b0ea863bc93b06e2ff8a5666c">h_escape_string_with_quotes</a></div><div class="ttdeci">char * h_escape_string_with_quotes(const struct _h_connection *conn, const char *unsafe)</div><div class="ttdef"><b>Definition:</b> hoel.c:103</div></div>
</div><!-- fragment --><h3><a class="anchor" id="autotoc_md25"></a>
Build a more complicated where clause</h3>
<p>When you need to run a query with a where clause using multiple parameters, such as &lsquo;WHERE col1='a&rsquo; AND (col2='b' OR col3=5) AND col4=42.3<code>, you can use the operator</code>raw`:</p>
<div class="fragment"><div class="line">{</div>
<div class="line">  &quot;table&quot;: &quot;table1&quot;,</div>
<div class="line">  &quot;columns&quot;: [&quot;col1&quot;, &quot;col2&quot;]</div>
<div class="line">  &quot;where&quot;: {</div>
<div class="line">    &quot; &quot;: {</div>
<div class="line">      &quot;operator&quot;, &quot;raw&quot;,</div>
<div class="line">      &quot;value&quot;, &quot;col1=&#39;a&#39; AND (col2=&#39;b&#39; or col3=&#39;c&#39;) AND col4=5&quot;</div>
<div class="line">    }</div>
<div class="line">  }</div>
<div class="line">}</div>
</div><!-- fragment --><p>In some cases, you may need to build the where clause with multiple variables. In hoel 1.4.27, the function <code>h_build_where_clause</code> was introduced to help that. Please note that this function is still in Beta.</p>
<div class="fragment"><div class="line"> </div>
<div class="line"><span class="keywordtype">char</span> * <a class="code" href="group__json.html#ga8a602b172eafc2abbd6de3ca07b3fcd0">h_build_where_clause</a>(<span class="keyword">const</span> <span class="keyword">struct</span> <a class="code" href="struct__h__connection.html">_h_connection</a> * conn, <span class="keyword">const</span> <span class="keywordtype">char</span> * pattern, ...);</div>
<div class="ttc" id="agroup__json_html_ga8a602b172eafc2abbd6de3ca07b3fcd0"><div class="ttname"><a href="group__json.html#ga8a602b172eafc2abbd6de3ca07b3fcd0">h_build_where_clause</a></div><div class="ttdeci">char * h_build_where_clause(const struct _h_connection *conn, const char *pattern,...)</div><div class="ttdef"><b>Definition:</b> hoel-simple-json.c:795</div></div>
</div><!-- fragment --><p>Then, to build the where clause above using <code>h_build_where_clause</code>, you can use the following code:</p>
<div class="fragment"><div class="line"><span class="keyword">const</span> <span class="keywordtype">char</span> col1[] = <span class="stringliteral">&quot;a&quot;</span>, col2[] = <span class="stringliteral">&quot;b&quot;</span>;</div>
<div class="line">json_int_t col3 = 5;</div>
<div class="line"><span class="keywordtype">double</span> col4 = 42.3;</div>
<div class="line"><span class="keywordtype">char</span> * where_clause = <a class="code" href="group__json.html#ga8a602b172eafc2abbd6de3ca07b3fcd0">h_build_where_clause</a>(<span class="stringliteral">&quot;col1=%s AND (col2=&#39;S&#39; OR col3=%d) AND col4=%f&quot;</span>, col1, col2, col3, col4);</div>
<div class="line">json_t * j_query = json_pack(<span class="stringliteral">&quot;{sss[ss]s{s{ssss}}}&quot;</span>,</div>
<div class="line">                             <span class="stringliteral">&quot;table&quot;</span>, <span class="stringliteral">&quot;table1&quot;</span>,</div>
<div class="line">                             <span class="stringliteral">&quot;columns&quot;</span>,</div>
<div class="line">                               <span class="stringliteral">&quot;col1&quot;</span>,</div>
<div class="line">                               <span class="stringliteral">&quot;col2&quot;</span>,</div>
<div class="line">                             <span class="stringliteral">&quot;where&quot;</span>,</div>
<div class="line">                               <span class="stringliteral">&quot; &quot;</span>,</div>
<div class="line">                                 <span class="stringliteral">&quot;operator&quot;</span>, <span class="stringliteral">&quot;raw&quot;</span>,</div>
<div class="line">                                 <span class="stringliteral">&quot;value&quot;</span>, where_clause);</div>
<div class="line"><a class="code" href="group__memory.html#ga8e836d6e4152a26211a31f94b819ce56">h_free</a>(where_clause);</div>
<div class="line"><span class="comment">// Execute j_query</span></div>
</div><!-- fragment --><p>Note that if you use constant litteral for integer or double values, you should cast them first:</p>
<div class="fragment"><div class="line"><span class="keyword">const</span> <span class="keywordtype">char</span> col1[] = <span class="stringliteral">&quot;a&quot;</span>, col2[] = <span class="stringliteral">&quot;b&quot;</span>;</div>
<div class="line"><span class="keywordtype">char</span> * where_clause = <a class="code" href="group__json.html#ga8a602b172eafc2abbd6de3ca07b3fcd0">h_build_where_clause</a>(<span class="stringliteral">&quot;col1=%s AND (col2=&#39;S&#39; OR col3=%d) AND col4=%f&quot;</span>, col1, col2, (json_int_t)5, (<span class="keywordtype">double</span>)42.3);</div>
</div><!-- fragment --><h3><a class="anchor" id="autotoc_md26"></a>
Execute a SQL query</h3>
<p>To execute a SQL query, you can use the function <code>h_execute_query</code> which will run the query in the database specified by the parameter <code>conn</code>. If a <code>result</code> parameter is specified, the result of the query (if any) will be stored in the <code>result</code> structure.</p>
<div class="fragment"><div class="line"> </div>
<div class="line"><span class="keywordtype">int</span> <a class="code" href="group__h__result.html#gac4da4e6a96c38e2022718b0e9f5a411d">h_execute_query</a>(<span class="keyword">const</span> <span class="keyword">struct</span> <a class="code" href="struct__h__connection.html">_h_connection</a> * conn, <span class="keyword">const</span> <span class="keywordtype">char</span> * query, <span class="keyword">struct</span> <a class="code" href="struct__h__result.html">_h_result</a> * result, <span class="keywordtype">int</span> options);</div>
<div class="ttc" id="agroup__h__result_html_gac4da4e6a96c38e2022718b0e9f5a411d"><div class="ttname"><a href="group__h__result.html#gac4da4e6a96c38e2022718b0e9f5a411d">h_execute_query</a></div><div class="ttdeci">int h_execute_query(const struct _h_connection *conn, const char *query, struct _h_result *result, int options)</div><div class="ttdef"><b>Definition:</b> hoel.c:138</div></div>
<div class="ttc" id="astruct__h__result_html"><div class="ttname"><a href="struct__h__result.html">_h_result</a></div><div class="ttdef"><b>Definition:</b> hoel.h:140</div></div>
</div><!-- fragment --><h3><a class="anchor" id="autotoc_md27"></a>
Result structure</h3>
<p>The <code>struct <a class="el" href="struct__h__result.html">_h_result</a></code> is a structure containing the values returned by a query. The definition of the structure is:</p>
<div class="fragment"><div class="line"> </div>
<div class="line"><span class="keyword">struct </span><a class="code" href="struct__h__result.html">_h_result</a> {</div>
<div class="line">  <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="struct__h__result.html#a1f54b961d31584ab692e67d629c1e350">nb_rows</a>;</div>
<div class="line">  <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="struct__h__result.html#a89005cca8583b65926b0b6493e115f4c">nb_columns</a>;</div>
<div class="line">  <span class="keyword">struct </span><a class="code" href="struct__h__data.html">_h_data</a> ** <a class="code" href="struct__h__result.html#a5a94257899ef17092f6d56f6e942da6a">data</a>;</div>
<div class="line">};</div>
<div class="ttc" id="astruct__h__data_html"><div class="ttname"><a href="struct__h__data.html">_h_data</a></div><div class="ttdef"><b>Definition:</b> hoel.h:132</div></div>
<div class="ttc" id="astruct__h__result_html_a1f54b961d31584ab692e67d629c1e350"><div class="ttname"><a href="struct__h__result.html#a1f54b961d31584ab692e67d629c1e350">_h_result::nb_rows</a></div><div class="ttdeci">unsigned int nb_rows</div><div class="ttdef"><b>Definition:</b> hoel.h:141</div></div>
<div class="ttc" id="astruct__h__result_html_a5a94257899ef17092f6d56f6e942da6a"><div class="ttname"><a href="struct__h__result.html#a5a94257899ef17092f6d56f6e942da6a">_h_result::data</a></div><div class="ttdeci">struct _h_data ** data</div><div class="ttdef"><b>Definition:</b> hoel.h:143</div></div>
<div class="ttc" id="astruct__h__result_html_a89005cca8583b65926b0b6493e115f4c"><div class="ttname"><a href="struct__h__result.html#a89005cca8583b65926b0b6493e115f4c">_h_result::nb_columns</a></div><div class="ttdeci">unsigned int nb_columns</div><div class="ttdef"><b>Definition:</b> hoel.h:142</div></div>
</div><!-- fragment --><p>The data value is a 2 dimensional array with <code>struct <a class="el" href="struct__h__data.html">_h_data</a></code> variables. A <code>struct <a class="el" href="struct__h__data.html">_h_data</a></code> is defined as:</p>
<div class="fragment"><div class="line"> </div>
<div class="line"><span class="keyword">struct </span><a class="code" href="struct__h__data.html">_h_data</a> {</div>
<div class="line">  <span class="keywordtype">int</span> <a class="code" href="struct__h__data.html#a012cea152bfec077b2797193236a86fa">type</a>;</div>
<div class="line">  <span class="keywordtype">void</span> * <a class="code" href="struct__h__data.html#aa4e6327290e2182af0d518e6ac62d0cc">t_data</a>;</div>
<div class="line">};</div>
<div class="ttc" id="astruct__h__data_html_a012cea152bfec077b2797193236a86fa"><div class="ttname"><a href="struct__h__data.html#a012cea152bfec077b2797193236a86fa">_h_data::type</a></div><div class="ttdeci">int type</div><div class="ttdef"><b>Definition:</b> hoel.h:133</div></div>
<div class="ttc" id="astruct__h__data_html_aa4e6327290e2182af0d518e6ac62d0cc"><div class="ttname"><a href="struct__h__data.html#aa4e6327290e2182af0d518e6ac62d0cc">_h_data::t_data</a></div><div class="ttdeci">void * t_data</div><div class="ttdef"><b>Definition:</b> hoel.h:134</div></div>
</div><!-- fragment --><p>where <code>type</code> can be the following values:</p>
<div class="fragment"><div class="line"><span class="preprocessor">#define HOEL_COL_TYPE_INT    0</span></div>
<div class="line"><span class="preprocessor">#define HOEL_COL_TYPE_DOUBLE 1</span></div>
<div class="line"><span class="preprocessor">#define HOEL_COL_TYPE_TEXT   2</span></div>
<div class="line"><span class="preprocessor">#define HOEL_COL_TYPE_DATE   3</span></div>
<div class="line"><span class="preprocessor">#define HOEL_COL_TYPE_BLOB   4</span></div>
<div class="line"><span class="preprocessor">#define HOEL_COL_TYPE_NULL   5</span></div>
</div><!-- fragment --><p><code>t_data</code> will point to a <code>struct _h_type_*</code> corresponding to the type. The <code>struct _h_type_*</code> available are:</p>
<div class="fragment"><div class="line"> </div>
<div class="line"><span class="keyword">struct </span><a class="code" href="struct__h__type__int.html">_h_type_int</a> {</div>
<div class="line">  <span class="keywordtype">int</span> <a class="code" href="struct__h__type__int.html#a63b159bcf76ed3ee7c801e7acaf3665f">value</a>;</div>
<div class="line">};</div>
<div class="line"> </div>
<div class="line"><span class="keyword">struct </span><a class="code" href="struct__h__type__double.html">_h_type_double</a> {</div>
<div class="line">  <span class="keywordtype">double</span> <a class="code" href="struct__h__type__double.html#ad9d041d6bec810afb457c94879bf8577">value</a>;</div>
<div class="line">};</div>
<div class="line"> </div>
<div class="line"><span class="keyword">struct </span><a class="code" href="struct__h__type__datetime.html">_h_type_datetime</a> {</div>
<div class="line">  <span class="keyword">struct </span>tm <a class="code" href="struct__h__type__datetime.html#af555d83eb9314c26fb97487edb3ea778">value</a>;</div>
<div class="line">};</div>
<div class="line"> </div>
<div class="line"><span class="keyword">struct </span><a class="code" href="struct__h__type__text.html">_h_type_text</a> {</div>
<div class="line">  <span class="keywordtype">char</span> * <a class="code" href="struct__h__type__text.html#aba822203767cd4c172d99e00a3a1f0d2">value</a>;</div>
<div class="line">};</div>
<div class="line"> </div>
<div class="line"><span class="keyword">struct </span><a class="code" href="struct__h__type__blob.html">_h_type_blob</a> {</div>
<div class="line">  <span class="keywordtype">size_t</span> <a class="code" href="struct__h__type__blob.html#ad6a81fa5351918d2b1d0367ac706e4a7">length</a>;</div>
<div class="line">  <span class="keywordtype">void</span> * <a class="code" href="struct__h__type__blob.html#ae3950b9a6d86c25d0f590d2ab85de203">value</a>;</div>
<div class="line">};</div>
<div class="ttc" id="astruct__h__type__blob_html"><div class="ttname"><a href="struct__h__type__blob.html">_h_type_blob</a></div><div class="ttdef"><b>Definition:</b> hoel.h:124</div></div>
<div class="ttc" id="astruct__h__type__blob_html_ad6a81fa5351918d2b1d0367ac706e4a7"><div class="ttname"><a href="struct__h__type__blob.html#ad6a81fa5351918d2b1d0367ac706e4a7">_h_type_blob::length</a></div><div class="ttdeci">size_t length</div><div class="ttdef"><b>Definition:</b> hoel.h:125</div></div>
<div class="ttc" id="astruct__h__type__blob_html_ae3950b9a6d86c25d0f590d2ab85de203"><div class="ttname"><a href="struct__h__type__blob.html#ae3950b9a6d86c25d0f590d2ab85de203">_h_type_blob::value</a></div><div class="ttdeci">void * value</div><div class="ttdef"><b>Definition:</b> hoel.h:126</div></div>
<div class="ttc" id="astruct__h__type__datetime_html"><div class="ttname"><a href="struct__h__type__datetime.html">_h_type_datetime</a></div><div class="ttdef"><b>Definition:</b> hoel.h:109</div></div>
<div class="ttc" id="astruct__h__type__datetime_html_af555d83eb9314c26fb97487edb3ea778"><div class="ttname"><a href="struct__h__type__datetime.html#af555d83eb9314c26fb97487edb3ea778">_h_type_datetime::value</a></div><div class="ttdeci">struct tm value</div><div class="ttdef"><b>Definition:</b> hoel.h:110</div></div>
<div class="ttc" id="astruct__h__type__double_html"><div class="ttname"><a href="struct__h__type__double.html">_h_type_double</a></div><div class="ttdef"><b>Definition:</b> hoel.h:102</div></div>
<div class="ttc" id="astruct__h__type__double_html_ad9d041d6bec810afb457c94879bf8577"><div class="ttname"><a href="struct__h__type__double.html#ad9d041d6bec810afb457c94879bf8577">_h_type_double::value</a></div><div class="ttdeci">double value</div><div class="ttdef"><b>Definition:</b> hoel.h:103</div></div>
<div class="ttc" id="astruct__h__type__int_html"><div class="ttname"><a href="struct__h__type__int.html">_h_type_int</a></div><div class="ttdef"><b>Definition:</b> hoel.h:95</div></div>
<div class="ttc" id="astruct__h__type__int_html_a63b159bcf76ed3ee7c801e7acaf3665f"><div class="ttname"><a href="struct__h__type__int.html#a63b159bcf76ed3ee7c801e7acaf3665f">_h_type_int::value</a></div><div class="ttdeci">long long int value</div><div class="ttdef"><b>Definition:</b> hoel.h:96</div></div>
<div class="ttc" id="astruct__h__type__text_html"><div class="ttname"><a href="struct__h__type__text.html">_h_type_text</a></div><div class="ttdef"><b>Definition:</b> hoel.h:116</div></div>
<div class="ttc" id="astruct__h__type__text_html_aba822203767cd4c172d99e00a3a1f0d2"><div class="ttname"><a href="struct__h__type__text.html#aba822203767cd4c172d99e00a3a1f0d2">_h_type_text::value</a></div><div class="ttdeci">char * value</div><div class="ttdef"><b>Definition:</b> hoel.h:118</div></div>
</div><!-- fragment --><h3><a class="anchor" id="autotoc_md28"></a>
Clean results or data</h3>
<p>To clean a result or a data structure, you can use its dedicated functions:</p>
<div class="fragment"><div class="line"> </div>
<div class="line"><span class="keywordtype">int</span> <a class="code" href="group__h__result.html#ga73e1db71f8116899d8f0d3fbdef52fe9">h_clean_result</a>(<span class="keyword">struct</span> <a class="code" href="struct__h__result.html">_h_result</a> * result);</div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">int</span> <a class="code" href="group__h__result.html#ga7354340a71530db5871477ca9983d942">h_clean_data</a>(<span class="keyword">struct</span> <a class="code" href="struct__h__data.html">_h_data</a> * data);</div>
<div class="ttc" id="agroup__h__result_html_ga7354340a71530db5871477ca9983d942"><div class="ttname"><a href="group__h__result.html#ga7354340a71530db5871477ca9983d942">h_clean_data</a></div><div class="ttdeci">int h_clean_data(struct _h_data *data)</div><div class="ttdef"><b>Definition:</b> hoel.c:445</div></div>
<div class="ttc" id="agroup__h__result_html_ga73e1db71f8116899d8f0d3fbdef52fe9"><div class="ttname"><a href="group__h__result.html#ga73e1db71f8116899d8f0d3fbdef52fe9">h_clean_result</a></div><div class="ttdeci">int h_clean_result(struct _h_result *result)</div><div class="ttdef"><b>Definition:</b> hoel.c:422</div></div>
</div><!-- fragment --><h3><a class="anchor" id="autotoc_md29"></a>
Get last id inserted</h3>
<p>If you need the last id generated after an insert query, you can use the following function:</p>
<div class="fragment"><div class="line"> </div>
<div class="line"><span class="keyword">struct </span><a class="code" href="struct__h__data.html">_h_data</a> * <a class="code" href="group__h__result.html#gaee69f45ae51d30004128d2fea578a215">h_query_last_insert_id</a>(<span class="keyword">const</span> <span class="keyword">struct</span> <a class="code" href="struct__h__connection.html">_h_connection</a> * conn);</div>
<div class="ttc" id="agroup__h__result_html_gaee69f45ae51d30004128d2fea578a215"><div class="ttname"><a href="group__h__result.html#gaee69f45ae51d30004128d2fea578a215">h_query_last_insert_id</a></div><div class="ttdeci">struct _h_data * h_query_last_insert_id(const struct _h_connection *conn)</div><div class="ttdef"><b>Definition:</b> hoel.c:327</div></div>
</div><!-- fragment --><h3><a class="anchor" id="autotoc_md30"></a>
Additional query functions</h3>
<p>You can use additional functions for specific needs. All these function will use <code>h_execute_query</code> but check input parameters before.</p>
<div class="fragment"><div class="line"> </div>
<div class="line"><span class="keywordtype">int</span> <a class="code" href="group__h__result.html#ga2059c4addcd2b5e9d21948e84b04e6e3">h_query_insert</a>(<span class="keyword">const</span> <span class="keyword">struct</span> <a class="code" href="struct__h__connection.html">_h_connection</a> * conn, <span class="keyword">const</span> <span class="keywordtype">char</span> * query);</div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">int</span> <a class="code" href="group__h__result.html#ga26b26b857754b240163242e8a69e6ee1">h_query_update</a>(<span class="keyword">const</span> <span class="keyword">struct</span> <a class="code" href="struct__h__connection.html">_h_connection</a> * conn, <span class="keyword">const</span> <span class="keywordtype">char</span> * query);</div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">int</span> <a class="code" href="group__h__result.html#gad5fd3abd6fa8b69e66c2b8a0be0c8c31">h_query_delete</a>(<span class="keyword">const</span> <span class="keyword">struct</span> <a class="code" href="struct__h__connection.html">_h_connection</a> * conn, <span class="keyword">const</span> <span class="keywordtype">char</span> * query);</div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">int</span> <a class="code" href="group__h__result.html#ga6a32dbb87ff1e44d3714a2db7cc61024">h_query_select</a>(<span class="keyword">const</span> <span class="keyword">struct</span> <a class="code" href="struct__h__connection.html">_h_connection</a> * conn, <span class="keyword">const</span> <span class="keywordtype">char</span> * query, <span class="keyword">struct</span> <a class="code" href="struct__h__result.html">_h_result</a> * result);</div>
<div class="ttc" id="agroup__h__result_html_ga2059c4addcd2b5e9d21948e84b04e6e3"><div class="ttname"><a href="group__h__result.html#ga2059c4addcd2b5e9d21948e84b04e6e3">h_query_insert</a></div><div class="ttdeci">int h_query_insert(const struct _h_connection *conn, const char *query)</div><div class="ttdef"><b>Definition:</b> hoel.c:314</div></div>
<div class="ttc" id="agroup__h__result_html_ga26b26b857754b240163242e8a69e6ee1"><div class="ttname"><a href="group__h__result.html#ga26b26b857754b240163242e8a69e6ee1">h_query_update</a></div><div class="ttdeci">int h_query_update(const struct _h_connection *conn, const char *query)</div><div class="ttdef"><b>Definition:</b> hoel.c:371</div></div>
<div class="ttc" id="agroup__h__result_html_ga6a32dbb87ff1e44d3714a2db7cc61024"><div class="ttname"><a href="group__h__result.html#ga6a32dbb87ff1e44d3714a2db7cc61024">h_query_select</a></div><div class="ttdeci">int h_query_select(const struct _h_connection *conn, const char *query, struct _h_result *result)</div><div class="ttdef"><b>Definition:</b> hoel.c:397</div></div>
<div class="ttc" id="agroup__h__result_html_gad5fd3abd6fa8b69e66c2b8a0be0c8c31"><div class="ttname"><a href="group__h__result.html#gad5fd3abd6fa8b69e66c2b8a0be0c8c31">h_query_delete</a></div><div class="ttdeci">int h_query_delete(const struct _h_connection *conn, const char *query)</div><div class="ttdef"><b>Definition:</b> hoel.c:384</div></div>
</div><!-- fragment --><h3><a class="anchor" id="autotoc_md31"></a>
Simple JSON queries</h3>
<p>Hoel allows to use JSON objects for simple queries with <code>jansson</code> library. In the simple JSON queries, a JSON object called <code>json_t * j_query</code> is used to generate the query.</p>
<p>All <code>json_t *</code> returned and updated values must be free after use.</p>
<p>A <code>j_query</code> has the following form: </p><div class="fragment"><div class="line">{</div>
<div class="line">  &quot;table&quot;: &quot;table_name&quot;             // String, mandatory, the table name where the query is executed</div>
<div class="line">  &quot;columns&quot;: [&quot;col1&quot;, &quot;col2&quot;]       // Array of strings, available for h_select, optional. If not specified,will be used</div>
<div class="line">  &quot;order_by&quot;: &quot;col_name [asc|desc]&quot; // String, available for h_select, specify the order by clause, optional</div>
<div class="line">  &quot;limit&quot;: integer_value            // Integer, available for h_select, specify the limit value, optional</div>
<div class="line">  &quot;offset&quot;                          // Integer, available for h_select, specify the limit value, optional but available only if limit is set</div>
<div class="line">  &quot;values&quot;: [{                      // JSON object or JSON array of JSON objects, available for h_insert, mandatory, specify the values to update</div>
<div class="line">    &quot;col1&quot;: &quot;value1&quot;,               // Generates col1=&#39;value1&#39; for an update query</div>
<div class="line">    &quot;col2&quot;: value_integer,          // Generates col2=value_integer for an update query</div>
<div class="line">    &quot;col3&quot;, &quot;value3&quot;,               // Generates col3=&#39;value3&#39; for an update query</div>
<div class="line">    &quot;col4&quot;, null                    // Generates col4=NULL for an update query</div>
<div class="line">  }]</div>
<div class="line">  &quot;set&quot;: {                          // JSON object, available for h_update, mandatory, specify the values to update</div>
<div class="line">    &quot;col1&quot;: &quot;value1&quot;,               // Generates col1=&#39;value1&#39; for an update query</div>
<div class="line">    &quot;col2&quot;: value_integer,          // Generates col2=value_integer for an update query</div>
<div class="line">    &quot;col3&quot;, &quot;value3&quot;,               // Generates col3=&#39;value3&#39; for an update query</div>
<div class="line">    &quot;col4&quot;, null                    // Generates col4=NULL for an update query</div>
<div class="line">  }</div>
<div class="line">  &quot;where&quot;: {                        // JSON object, available for h_select, h_update and h_delete, mandatory, specify the where clause. All clauses are separated with an AND operator</div>
<div class="line">    &quot;col1&quot;: &quot;value1&quot;,               // Generates col1=&#39;value1&#39;</div>
<div class="line">    &quot;col2&quot;: value_integer,          // Generates col2=value_integer</div>
<div class="line">    &quot;col3&quot;: null,                   // Generates col3=NULL</div>
<div class="line">    &quot;col4&quot;: {                       // Generates col4&lt;12</div>
<div class="line">      &quot;operator&quot;: &quot;&lt;&quot;,</div>
<div class="line">      &quot;value&quot;: 12</div>
<div class="line">    },</div>
<div class="line">    &quot;col5&quot;: {                       // Generates col5 IS NOT NULL</div>
<div class="line">      &quot;operator&quot;: &quot;NOT NULL&quot;</div>
<div class="line">    },</div>
<div class="line">    &quot;col6&quot;: {                       // Generates col6 LIKE &#39;%value6%&#39;</div>
<div class="line">      &quot;operator&quot;: &quot;raw&quot;,</div>
<div class="line">      &quot;value&quot;: &quot;LIKE &#39;%value6%&#39;&quot;</div>
<div class="line">    },</div>
<div class="line">    &quot;col7&quot;: {</div>
<div class="line">      &quot;operator&quot;: &quot;IN&quot;,             // Generates col7 IN (&#39;value1&#39;,42,4.2)</div>
<div class="line">      &quot;value&quot;: [                    // Values can be string, real or integer</div>
<div class="line">        &quot;value1&quot;,</div>
<div class="line">        42,</div>
<div class="line">        4.2</div>
<div class="line">      ]</div>
<div class="line">    }</div>
<div class="line">  }</div>
<div class="line">}</div>
</div><!-- fragment --><h4><a class="anchor" id="autotoc_md32"></a>
Where clause construction</h4>
<p>A <code>where</code> clause is a JSON object containing a series of clauses. A clause can have 2 different forms:</p>
<ul>
<li><code>col_name: value</code></li>
<li><code>col_name: {operator: "operator_value", value: value}</code></li>
</ul>
<p>In the first case, <code>col_name: value</code>, the clause becomes <code>col_name = value</code>. Value is always escaped.</p>
<p>In the second case, <code>col_name: {operator: "operator_value", value: value}</code>, depending on the <code>operator</code> value, the clause can have different forms:</p><ul>
<li><code>operator: "NOT NULL"</code>, the clause becomes <code>col_name IS NOT NULL</code></li>
<li><code>operator: "raw"</code>, the <code>value</code> value becomes the clause itself, not escaped, for example in &lsquo;{ "operator": "raw", "value": "LIKE &amp;rsquo;%value6%'" }<code>, the clause becomes</code>col6 LIKE 'value6'<code></code></li>
<li><code>otherwise, the clause becomes</code>col_name operator value`, value is escaped</li>
</ul>
<p>All clauses are separated by an <code>AND</code> operator.</p>
<p>As en example, here is a JSON object and its generated where clause:</p>
<p>JSON object: </p><div class="fragment"><div class="line">{</div>
<div class="line">  &quot;col1&quot;: &quot;value1&quot;,</div>
<div class="line">  &quot;col2&quot;: 42,</div>
<div class="line">  &quot;col3&quot;: {</div>
<div class="line">    &quot;operator&quot;: &quot;&gt;=&quot;,</div>
<div class="line">    &quot;value&quot;: 55.5</div>
<div class="line">  },</div>
<div class="line">  &quot;col4&quot;: {</div>
<div class="line">    &quot;operator&quot;: &quot;raw&quot;,</div>
<div class="line">    &quot;value&quot;: &quot;LIKE &#39;%alu%&#39;&quot;</div>
<div class="line">  }</div>
<div class="line">}</div>
</div><!-- fragment --><p>SQL Where clause: </p><div class="fragment"><div class="line"><span class="keyword">WHERE</span> col1 = <span class="stringliteral">&#39;value1&#39;</span></div>
<div class="line">  <span class="keyword">AND</span> col2 = <span class="stringliteral">42</span></div>
<div class="line">  <span class="keyword">AND</span> col3 &gt;= <span class="stringliteral">55</span>.<span class="stringliteral">5</span></div>
<div class="line">  <span class="keyword">AND</span> col4 <span class="keyword">LIKE</span> <span class="stringliteral">&#39;%alu%&#39;</span></div>
</div><!-- fragment --><p>If you need less simple clauses, you can build it on your own and use the <code>h_execute_query</code> or the <code>h_execute_query_json</code> functions.</p>
<p>The simple JSON queries functions are:</p>
<div class="fragment"><div class="line"> </div>
<div class="line"><span class="keywordtype">int</span> <a class="code" href="group__json.html#gaa8e35275d04ef39c7e08262b094c43e3">h_select</a>(<span class="keyword">const</span> <span class="keyword">struct</span> <a class="code" href="struct__h__connection.html">_h_connection</a> * conn, <span class="keyword">const</span> json_t * j_query, json_t ** j_result, <span class="keywordtype">char</span> ** generated_query);</div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">int</span> <a class="code" href="group__json.html#gac54383a1213ccf6c74baa1fd82f9ae44">h_insert</a>(<span class="keyword">const</span> <span class="keyword">struct</span> <a class="code" href="struct__h__connection.html">_h_connection</a> * conn, <span class="keyword">const</span> json_t * j_query, <span class="keywordtype">char</span> ** generated_query);</div>
<div class="line"> </div>
<div class="line">json_t * <a class="code" href="group__json.html#ga932b15081a50a9016f151464385111d6">h_last_insert_id</a>(<span class="keyword">const</span> <span class="keyword">struct</span> <a class="code" href="struct__h__connection.html">_h_connection</a> * conn);</div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">int</span> <a class="code" href="group__json.html#gae94519fb1c32a405530cb43e244b71ee">h_update</a>(<span class="keyword">const</span> <span class="keyword">struct</span> <a class="code" href="struct__h__connection.html">_h_connection</a> * conn, <span class="keyword">const</span> json_t * j_query, <span class="keywordtype">char</span> ** generated_query);</div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">int</span> <a class="code" href="group__json.html#ga843285b39babfdb6e4f49be4a85588b6">h_delete</a>(<span class="keyword">const</span> <span class="keyword">struct</span> <a class="code" href="struct__h__connection.html">_h_connection</a> * conn, <span class="keyword">const</span> json_t * j_query, <span class="keywordtype">char</span> ** generated_query);</div>
<div class="ttc" id="agroup__json_html_ga843285b39babfdb6e4f49be4a85588b6"><div class="ttname"><a href="group__json.html#ga843285b39babfdb6e4f49be4a85588b6">h_delete</a></div><div class="ttdeci">int h_delete(const struct _h_connection *conn, const json_t *j_query, char **generated_query)</div><div class="ttdef"><b>Definition:</b> hoel-simple-json.c:750</div></div>
<div class="ttc" id="agroup__json_html_ga932b15081a50a9016f151464385111d6"><div class="ttname"><a href="group__json.html#ga932b15081a50a9016f151464385111d6">h_last_insert_id</a></div><div class="ttdeci">json_t * h_last_insert_id(const struct _h_connection *conn)</div><div class="ttdef"><b>Definition:</b> hoel-simple-json.c:662</div></div>
<div class="ttc" id="agroup__json_html_gaa8e35275d04ef39c7e08262b094c43e3"><div class="ttname"><a href="group__json.html#gaa8e35275d04ef39c7e08262b094c43e3">h_select</a></div><div class="ttdeci">int h_select(const struct _h_connection *conn, const json_t *j_query, json_t **j_result, char **generated_query)</div><div class="ttdef"><b>Definition:</b> hoel-simple-json.c:458</div></div>
<div class="ttc" id="agroup__json_html_gac54383a1213ccf6c74baa1fd82f9ae44"><div class="ttname"><a href="group__json.html#gac54383a1213ccf6c74baa1fd82f9ae44">h_insert</a></div><div class="ttdeci">int h_insert(const struct _h_connection *conn, const json_t *j_query, char **generated_query)</div><div class="ttdef"><b>Definition:</b> hoel-simple-json.c:592</div></div>
<div class="ttc" id="agroup__json_html_gae94519fb1c32a405530cb43e244b71ee"><div class="ttname"><a href="group__json.html#gae94519fb1c32a405530cb43e244b71ee">h_update</a></div><div class="ttdeci">int h_update(const struct _h_connection *conn, const json_t *j_query, char **generated_query)</div><div class="ttdef"><b>Definition:</b> hoel-simple-json.c:700</div></div>
</div><!-- fragment --><h4><a class="anchor" id="autotoc_md33"></a>
JSON last insert id</h4>
<p>The function <code>h_last_insert_id</code> returns the last inserted id in a <code>json_t *</code> format.</p>
<div class="fragment"><div class="line"> </div>
<div class="line">json_t * <a class="code" href="group__json.html#ga932b15081a50a9016f151464385111d6">h_last_insert_id</a>(<span class="keyword">const</span> <span class="keyword">struct</span> <a class="code" href="struct__h__connection.html">_h_connection</a> * conn);</div>
</div><!-- fragment --><h3><a class="anchor" id="autotoc_md34"></a>
Example source code</h3>
<p>See <code>examples</code> folder for detailed sample source codes. </p>
</div></div><!-- PageDoc -->
</div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by&#160;<a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.1
</small></address>
</body>
</html>
